# Ansible Map

This is a remake of the map tab currently found on
https://stats.eng.ansible.com/apps/meetups (second tab)

It is a work-in-progress and will eventually replace the current map.

## Data Sources

The map uses two data sources

1) The Meetup API data generated from the current meetup app
  a) Eventually, this needs to move to here or to a new backend project
2) The PR data generated by the Collections crawler
  b) This lives [on Github too](https://github.com/ansible-community/stats-collections/tree/main/crawler-config)

## Uses of the data

1) Meetup

We can do quite a bit with the meetup data. Ideally we want to represent
location, size, and activeness of each meetup, which we do like this:

* Location - Meetup API will provide a lat/lon of the meetup, which we use
* Size - This is a bit arbitrary, as we don't *really* know how many people
  *actually* turn up. So, we use the size of the Meetup group
* Activeness - Harder, see below

For activeness, we really care about the combined effect of a few things. We
know some things about all the events the group has had to-date, such as when
it was and how many people RSVPd. That means we can calculate:

* The frequency (n/year)
* The reliability of the scheduling (the variance of the gaps between events)
* Attendance trend (modelling RSVPs and seeing what the slope is)

Combined in some way (TBD) these determine an "activity" which we can use as a
transpancy layer on the map, effectively hiding inactive meetups (perhaps a
floor of 0.1 so they can still be just-about seen?)

2) GitHub

The Stats Collections Crawler runs nightly and indexes the Issues and PRs of every collection to MongoDB. We can use this as follows:

* Get a unique list of issue/PR authors across all the collections
* Peform GH API queries for their location data (this is an arbitrary string)
* Perform Geocoding on the location strings, discarding anything that doesn't work (null, localhost, behind you, etc)
* Just keep the "country" field from the geocoding, for privacy
* Join this back to the Issue/PR data

At this point we can do a count of PRs/country and use that to colour the map.

I'm assuming that people who put real location data in a GH profile don't mind
people looking at it - but this is a grey area.  If you do not want to be
included in the map, mail me at gsutclif AT redhat DOT com, and I'll mark your
username for exclusion.

## Layers

* Countries -> GH data
  * Controls: Issues/PRs/Both
* Points -> Meetup locations
* Radii -> Meetup size
* Alpha -> Meetup activity
  * Controls: Date range for events?

## TODO

Everything. Help welcome :)
